{% extends "base.html" %} {% block title %}Shopping Cart | BuyBuy{% endblock %}
{% block content %}
<div class="container">
  <div class="card">
    <div class="card-header">
      <h2 class="card-title">Shopping Cart</h2>
    </div>
    <div class="card-body">
      {% if cart_items %}
      <div class="table-responsive">
        <table class="table">
          <thead>
            <tr>
              <th>Product</th>
              <th>Price</th>
              <th>Quantity</th>
              <th>Subtotal</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for item in cart_items %}
            <tr>
              <td>
                <div class="cart-product">
                  {% if item.product.image_url %}
                  <img
                    src="{{ item.product.image_url }}"
                    alt="{{ item.product.name }}"
                    class="cart-product-image"
                  />
                  {% endif %}
                  <div class="cart-product-info">
                    <h5>
                      <a
                        href="{% url 'products:product_detail' item.product.id %}"
                        >{{ item.product.name }}</a
                      >
                    </h5>
                    <small class="text-muted"
                      >Sold by {{ item.product.seller.username }}</small
                    >
                  </div>
                </div>
              </td>
              <td>${{ item.product.price }}</td>
              <td>
                <form
                  method="post"
                  action="{% url 'products:update_cart_item' item.id %}"
                  class="update-quantity-form"
                >
                  {% csrf_token %}
                  <div class="quantity-controls">
                    <input
                      type="number"
                      name="quantity"
                      value="{{ item.quantity }}"
                      min="1"
                      max="{{ item.product.stock_quantity }}"
                      class="form-control quantity-input"
                    />
                    <button
                      type="submit"
                      class="btn btn-sm btn-outline"
                    >
                      Update
                    </button>
                  </div>
                </form>
              </td>
              <td>${{ item.total_price }}</td>
              <td>
                <form
                  method="post"
                  action="{% url 'products:remove_from_cart' item.id %}"
                  style="display: inline"
                >
                  {% csrf_token %}
                  <button
                    type="submit"
                    class="btn btn-sm btn-danger"
                    onclick="return confirm('Remove this item from cart?')"
                  >
                    Remove
                  </button>
                </form>
              </td>
            </tr>
            {% endfor %}
          </tbody>
          <tfoot>
            <tr class="table-total">
              <td colspan="3"><strong>Total:</strong></td>
              <td><strong>${{ cart_total }}</strong></td>
              <td></td>
            </tr>
          </tfoot>
        </table>
      </div>

      <div class="cart-actions">
        <a
          href="{% url 'products:product_list' %}"
          class="btn btn-secondary"
          >Continue Shopping</a
        >
        <a
          href="{% url 'products:checkout' %}"
          class="btn btn-success"
          >Proceed to Checkout</a
        >
      </div>
      {% else %}
      <div class="text-center py-4">
        <h4>Your Cart is Empty</h4>
        <p>Looks like you haven't added anything to your cart yet.</p>
        <a
          href="{% url 'products:product_list' %}"
          class="btn btn-primary"
          >Start Shopping</a
        >
      </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
