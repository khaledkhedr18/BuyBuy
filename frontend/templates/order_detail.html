{% extends "base.html" %} {% block title %}Order Details | BuyBuy{% endblock %}
{% block content %}
<div class="container">
  <div class="card">
    <div class="card-header">
      <h2 class="card-title">Order #{{ order.id }}</h2>
      <span class="order-status status-{{ order.status|lower }}"
        >{{ order.get_status_display }}</span
      >
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-6">
          <h4>Order Information</h4>
          <div class="order-info">
            <p>
              <strong>Order Date:</strong> {{ order.created_at|date:"F j, Y g:i A" }}
            </p>
            <p><strong>Status:</strong> {{ order.get_status_display }}</p>
            <p><strong>Total Amount:</strong> ${{ order.total_amount }}</p>
          </div>

          <h4 class="mt-4">Shipping Address</h4>
          <div class="shipping-address">
            <p>{{ order.shipping_address }}</p>
          </div>
        </div>

        <div class="col-md-6">
          <h4>Customer Information</h4>
          <div class="customer-info">
            <p>
              <strong>Name:</strong> {{ order.buyer.get_full_name|default:order.buyer.username }}
            </p>
            <p><strong>Email:</strong> {{ order.buyer.email }}</p>
          </div>
        </div>
      </div>

      <hr />

      <h4>Order Items</h4>
      <div class="table-responsive">
        <table class="table">
          <thead>
            <tr>
              <th>Product</th>
              <th>Seller</th>
              <th>Price</th>
              <th>Quantity</th>
              <th>Subtotal</th>
            </tr>
          </thead>
          <tbody>
            {% for item in order.items.all %}
            <tr>
              <td>
                <div class="order-item-product">
                  {% if item.product.image_url %}
                  <img
                    src="{{ item.product.image_url }}"
                    alt="{{ item.product.name }}"
                    class="order-item-image"
                  />
                  {% endif %}
                  <div>
                    <h5>
                      <a
                        href="{% url 'frontend_products:product_detail' item.product.id %}"
                        >{{ item.product.name }}</a
                      >
                    </h5>
                    <small class="text-muted"
                      >{{ item.product.category.name }}</small
                    >
                  </div>
                </div>
              </td>
              <td>{{ item.product.seller.username }}</td>
              <td>${{ item.price }}</td>
              <td>{{ item.quantity }}</td>
              <td>${{ item.total_price }}</td>
            </tr>
            {% endfor %}
          </tbody>
          <tfoot>
            <tr class="table-total">
              <td colspan="4"><strong>Total:</strong></td>
              <td><strong>${{ order.total_amount }}</strong></td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>

    <div class="card-footer">
      <a
        href="{% url 'frontend_products:my_orders' %}"
        class="btn btn-secondary"
        >‚Üê Back to Orders</a
      >
      {% if order.status == 'pending' %}
      <button
        type="button"
        class="btn btn-danger"
        onclick="cancelOrder({{ order.id }})"
      >
        Cancel Order
      </button>
      {% endif %}
    </div>
  </div>
</div>

<script>
  function cancelOrder(orderId) {
    if (confirm('Are you sure you want to cancel this order?')) {
      var form = document.createElement('form');
      form.method = 'POST';
      form.action = '/products/orders/' + orderId + '/cancel/';

      var csrfToken = document.querySelector(
        '[name=csrfmiddlewaretoken]',
      ).value;
      var csrfInput = document.createElement('input');
      csrfInput.type = 'hidden';
      csrfInput.name = 'csrfmiddlewaretoken';
      csrfInput.value = csrfToken;
      form.appendChild(csrfInput);

      document.body.appendChild(form);
      form.submit();
    }
  }
</script>
{% endblock %}
